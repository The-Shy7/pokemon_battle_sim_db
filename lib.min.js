var token;var pid;const SERVICE_URL="https://oxford.cs.washington.edu/cse154/pokedex-2/";var myPokemon;function $(id){return document.getElementById(id)}function $$(q){var elements=document.querySelectorAll(q);return elements.length==1?elements[0]:elements}function hide(elems){if(elems instanceof Array){for(var i=0;i<elems.length;i++){elems[i].classList.add("hidden")}}else{elems.classList.add("hidden")}}function show(elems){if(elems instanceof Array){for(var i=0;i<elems.length;i++){elems[i].classList.remove("hidden")}}else{elems.classList.remove("hidden")}}function toggleDisplay(elems){if(elems instanceof Array){for(var i=0;i<elems.length;i++){elems[i].classList.toggle("hidden")}}else{elems.classList.toggle("hidden")}}function gen(el,classes){var element=document.createElement(el);if(classes&&classes!=""){if(classes instanceof Array){for(var i=0;i<classes.length;i++){element.classList.add(classes[i])}}else{element.classList.add(classes)}}return element}function genText(el,text){var element=document.createElement(el);element.innerText=text;return element}function appendChildren(papa,kiddos){for(var i=0;i<kiddos.length;i++){papa.appendChild(kiddos[i])}return papa}function escSpChar(string){var specialChar=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","`","{","|","}","~"," "];for(var i=0;i<string.length;i++){if(specialChar.includes(string.charAt(i))){string=string.slice(0,i)+"\\"+string.slice(i);i+=1}}return string}function getRequest(url,params,onloadfn){let fetchParams={};fetch(url+params,fetchParams).then(checkStatus).then(onloadfn).catch(console.log)}function postRequest(url,params,onloadfn){let fetchParams={method:"POST",body:params};fetch(url,fetchParams).then(checkStatus).then(onloadfn).catch(console.log)}function handleGetCreds(responseText){let result=responseText.split("\n");if(result.length<2){console.log("Error: getcreds.php does not output pid and token on separate lines.")}else{pid=result[0];token=result[1];console.log("getcreds.php call finished. pid: "+pid+", token: "+token)}}function fetchPid(){if(!(pid&&token)){console.log("Calling getcreds.php...");getRequest("getcreds.php","",handleGetCreds)}}function restartMyDex(newPokemons){let params=new FormData;params.append("mode","removeall");console.log("Calling delete.php with mode=removeall...");postRequest("delete.php",params,function(responseText){console.log("delete.php finished with mode=removeall");console.log("The following pokedex should be empty:");fetchMyPokemon();for(let i in newPokemons){addPokemon(newPokemons[i])}location.reload()})}function getDex(pid,token,force){let params=new FormData;params.append("pid",pid);params.append("token",token);if(force){params.append("force","true")}postRequest(SERVICE_URL+"restart.php",params,function(responseText){let result=JSON.parse(responseText);if(result.length>1){restartMyDex(result)}})}function removeFromPokedex(name){var params=new FormData;params.append("name",name);console.log("Calling delete.php with name="+name+"...");postRequest("delete.php",params,function(responseText){$(name).classList.add("unfound");$(name).onclick="";console.log("delete.php with name="+name+" returned:");console.log(JSON.parse(responseText));fetchMyPokemon()})}function fetchMyPokemon(){console.log("Calling select.php...");getRequest("select.php","",function(responseText){myPokemon=JSON.parse(responseText);console.log("select.php returned: ");console.log(myPokemon)})}function addPokemon(name){var params=new FormData;params.append("name",name);console.log("Calling insert.php with name="+name+"...");postRequest("insert.php",params,function(){console.log("insert.php finished.");fetchMyPokemon()})}function logStudentTestCall(responseText){console.log("Finished call to trade.php. Response: ");let response=JSON.parse(responseText);console.log(response)}function creds(){return"?pid="+pid+"&token="+token}function checkStatus(response){if(response.status>=200&&response.status<300||response.status==0){return response.text()}else{return Promise.reject(new Error(response.status+": "+response.statusText))}}
